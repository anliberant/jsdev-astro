---
import { siteConfig } from '@/app/config/site';
import Footer from '@/widgets/footer/footer.astro';
import Header from '@/widgets/header/header.astro';

import '@/shared/styles/global.css';

import ScrollToTop from '@/shared/ui/layout/scroll-to-top.astro';

export interface Props {
  title: string;
  description?: string;
  image?: string;
  type?: string;
  slug?: string;
  contentType?: string;
}

const {
  title,
  description = siteConfig.description,
  image = siteConfig.image,
  type = 'website',
  slug = '',
  contentType = '',
} = Astro.props;

const fullTitle = title || siteConfig.title;
const hasImage = typeof image === 'string' && image.trim() !== '';
const shouldUseGeneratedOG = ['howto', 'snippets'].includes(contentType.toLowerCase());

const fullImageUrl =
  shouldUseGeneratedOG ? `${siteConfig.siteUrl}/og/${slug}.png`
  : typeof image === 'string' && image.trim() !== '' ?
    image.startsWith('http') ?
      image
    : `${siteConfig.siteUrl}${image}`
  : siteConfig.image;
---

<!doctype html>
<html
  lang='en'
  data-theme='light'>
  <head>
    <meta charset='UTF-8' />
    <meta
      name='description'
      content={description}
    />
    <meta
      name='viewport'
      content='width=device-width, initial-scale=1.0'
    />
    <link
      rel='preconnect'
      href='https://fonts.googleapis.com'
    />
    <link
      rel='preconnect'
      href='https://fonts.gstatic.com'
      crossorigin
    />
    <link
      rel='icon'
      type='image/png'
      href='/icon.png'
    />
    <meta
      name='generator'
      content={Astro.generator}
    />
    <title>{fullTitle}</title>

    <!-- Umami Analytics -->
    <script
      defer
      src='https://cloud.umami.is/script.js'
      data-website-id='97be30e6-d00d-41c8-9353-a900d0f96dc7'
    ></script>
    <!-- Fonts -->
    <link
      href='https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&family=Roboto:wght@300;400;500;700&family=Fira+Code:wght@400;500&display=swap'
      rel='preload'
      as='style'
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript>
      <link
        href='https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&family=Roboto:wght@300;400;500;700&family=Fira+Code:wght@400;500&display=swap'
        rel='stylesheet'
      />
    </noscript>
    <link
      rel='alternate'
      type='application/rss+xml'
      title={siteConfig.title}
      href={new URL('rss.xml', Astro.site)}
    />
    <!-- SEO Meta Tags -->
    <meta
      property='og:title'
      content={fullTitle}
    />
    <meta
      property='og:description'
      content={description}
    />
    <meta
      property='og:image'
      content={fullImageUrl}
    />
    <meta
      property='og:url'
      content={Astro.url}
    />
    <meta
      property='og:type'
      content={type}
    />
    <meta
      property='og:site_name'
      content={siteConfig.shortTitle}
    />

    <!-- Twitter Card -->
    <meta
      name='twitter:card'
      content='summary_large_image'
    />
    <meta
      name='twitter:title'
      content={fullTitle}
    />
    <meta
      name='twitter:description'
      content={description}
    />
    <meta
      name='twitter:image'
      content={fullImageUrl}
    />
    {
      siteConfig.twitterUsername && (
        <meta
          name='twitter:site'
          content={siteConfig.twitterUsername}
        />
      )
    }

    <!-- Canonical URL (default, can be overridden) -->
    <link
      rel='canonical'
      href={Astro.url}
    />
    <link
      rel='sitemap'
      href='/sitemap-index.xml'
    />
    <!-- Additional head content slot -->
    <slot name='head' />
  </head>
  <body>
    <div class='container'>
      <Header />
      <slot />
      <Footer />
      <ScrollToTop />
    </div>
  </body>
</html>
